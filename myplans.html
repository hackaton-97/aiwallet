<!DOCTYPE html>
<html class="dark" lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>AI Wallet | My Plans</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
<style>
        .glow-border {
            box-shadow: 0 0 2px #A7C69F, 0 0 5px #A7C69F, 0 0 10px #A7C69F;
        }
        .glow-button {
            box-shadow: 0 0 5px #A7C69F, 0 0 10px #A7C69F, 0 0 15px #A7C69F;
        }
        .glow-text {
            text-shadow: 0 0 5px #A7C69F;
        }
        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }
        body {
            font-family: 'Space Grotesk', sans-serif;
            background-image:
                radial-gradient(circle at 10% 20%, rgba(167, 198, 159, 0.1) 0%, transparent 25%),
                radial-gradient(circle at 90% 80%, rgba(167, 198, 159, 0.1) 0%, transparent 25%);
            background-attachment: fixed;
        }
        /* Light mode styles */
        html:not(.dark) { 
            background-color: #ffffff !important;
            color: #1a1a1a;
        }
        html:not(.dark) body { 
            background-color: #ffffff !important;
            color: #1a1a1a;
        }
        html:not(.dark) [class*="text-white"] {
            color: #1a1a1a !important;
        }
        html:not(.dark) [class*="text-white/"] {
            color: rgba(26, 26, 26, 0.8) !important;
        }
        html:not(.dark) [class*="bg-black"] {
            background-color: #ffffff !important;
        }
        html:not(.dark) [class*="bg-black/"] {
            background-color: rgba(255, 255, 255, 0.95) !important;
        }
        html:not(.dark) [class*="bg-custom-bg"],
        html:not(.dark) [class*="bg-[#333333]"],
        html:not(.dark) [class*="bg-[#0a0a0a]"] {
            background-color: #f5f5f5 !important;
        }
        html:not(.dark) [class*="border-"] {
            border-color: #e0e0e0 !important;
        }
        html:not(.dark) [class*="text-[#A7C69F]"],
        html:not(.dark) [class*="text-custom-accent"] {
            color: #5a7a4f !important;
        }
        html:not(.dark) svg {
            color: #1a1a1a !important;
        }
        html:not(.dark) #profileModal {
            background-color: transparent !important;
        }
        html:not(.dark) #profileModal > div {
            background-color: #ffffff !important;
            border-color: #5a7a4f !important;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
        }
        html:not(.dark) #profileModal button,
        html:not(.dark) #profileModal a {
            color: #1a1a1a !important;
        }
        html:not(.dark) #profileModal button:last-child {
            color: #ef4444 !important;
        }
        html:not(.dark) #profileModal button:hover,
        html:not(.dark) #profileModal a:hover {
            background-color: #f0f0f0 !important;
        }
        html:not(.dark) #profileAvatar {
            border-color: #5a7a4f !important;
        }
        html:not(.dark) .bg-black\/20 {
            background-color: rgba(245, 245, 245, 0.8) !important;
        }
        html:not(.dark) .border-white\/20 {
            border-color: #e0e0e0 !important;
        }
        .plan-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .plan-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(167, 198, 159, 0.3);
        }
        .plan-card.pinned {
            border-color: #A7C69F;
            border-width: 2px;
        }
    </style>
<script src="script.js" defer></script>
</head>
<body class="font-display" style="background-color: #000000;">
<div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden text-white" style="background-image: linear-gradient(rgba(0, 0, 0, 0.95), rgba(0, 0, 0, 0.95)), url('https://lh3.googleusercontent.com/aida-public/AB6AXuCpFh7OSUzEj0XKLJfBIIV04v-GovLLGjGnzDoQbT0ps0Df9oU8HHpWzi4FU3EgN14NBNziFl4HZcvrKRIUfrB1wovmysIFaTBEbmc8R-7C8ndna4mgfw2eBXQcnnGJmYoAv3r98aJO0Nn8M4fCw14NBF3PWea5A4IR7yc2kkzNdVtZh8_iOgzDSH1Tvn6i9pRDZszXGg4L7kGCz_NRI0F8qoAkp4S5JrV2-3XpTR15xeC-kj1YhQ82SbMUKY4K9_ngc4YGUunxrFQL'); background-size: cover; background-attachment: fixed;">
<div class="layout-container flex h-full grow flex-col">
<div class="flex flex-1 justify-center py-5">
<div class="layout-content-container flex flex-col w-full max-w-[1100px] flex-1 px-4 sm:px-10">
<header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-custom-accent/20 px-4 py-3 backdrop-blur-sm bg-custom-bg/30 rounded-t-lg">
<a href="main.html" class="flex items-center gap-4 text-custom-accent cursor-pointer hover:opacity-80 transition-opacity">
<div class="size-4 text-glow">
<svg fill="none" viewbox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path clip-rule="evenodd" d="M24 4H6V17.3333V30.6667H24V44H42V30.6667V17.3333H24V4Z" fill="currentColor" fill-rule="evenodd"></path>
</svg>
</div>
<h2 class="text-custom-accent text-lg font-bold leading-tight tracking-[-0.015em] text-glow">AIWallet</h2>
</a>
<div class="flex flex-1 justify-end gap-8">
  <div class="flex items-center gap-9">
    <a id="createPlanLink" class="hidden text-white/80 text-sm font-medium leading-normal transition-colors hover:text-[#A7C69F] hover:drop-shadow-[0_0_8px_#A7C69F]" href="createplan.html">Create Plan</a>
    <a id="myPlansLink" class="hidden text-white/80 text-sm font-medium leading-normal transition-colors hover:text-[#A7C69F] hover:drop-shadow-[0_0_8px_#A7C69F]" href="myplans.html">My Plans</a>
    <a id="dashboardLink" class="hidden text-white/80 text-sm font-medium leading-normal transition-colors hover:text-[#A7C69F] hover:drop-shadow-[0_0_8px_#A7C69F]" href="profile.html">Dashboard</a>
    <a class="text-white/80 text-sm font-medium leading-normal transition-colors hover:text-[#A7C69F] hover:drop-shadow-[0_0_8px_#A7C69F]" href="pricing.html">Pricing</a>
  </div>
  <div class="flex gap-2">
    <button id="themeToggle" class="flex min-w-[40px] w-10 h-10 cursor-pointer items-center justify-center overflow-hidden rounded-lg bg-transparent border border-[#A7C69F]/50 text-custom-accent font-bold transition-all hover:bg-[#A7C69F]/10 hover:border-[#A7C69F] hover:shadow-[0_0_8px_#A7C69F_inset]" title="Toggle theme">
      <span id="themeIcon">ðŸŒ™</span>
    </button>
    <div id="authButtons" class="flex gap-2">
      <a id="getStartedBtn" href="signup.html" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-[#A7C69F] text-[#333333] text-sm font-bold leading-normal tracking-[0.015em] transition-all hover:bg-white hover:shadow-[0_0_15px_#A7C69F] border border-[#A7C69F]">
        <span class="truncate">Get Started</span>
      </a>
      <a href="signin.html" class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-lg h-10 px-4 bg-transparent border border-[#A7C69F]/50 text-white text-sm font-bold leading-normal tracking-[0.015em] transition-all hover:bg-[#A7C69F]/10 hover:border-[#A7C69F] hover:shadow-[0_0_8px_#A7C69F_inset]">
        <span class="truncate">Login</span>
      </a>
    </div>
    <div id="profileAvatar" class="hidden flex items-center justify-center w-10 h-10 rounded-lg bg-[#A7C69F] text-[#333333] font-bold text-lg cursor-pointer hover:shadow-[0_0_15px_#A7C69F] transition-all border border-[#A7C69F]" title="Profile" onclick="toggleProfileMenu()">
      <span id="avatarInitial">U</span>
    </div>
  </div>
</div>
</header>

<!-- Profile Menu Modal -->
<div id="profileModal" class="hidden fixed inset-0 z-50 flex items-start justify-end pt-20 pr-10" onclick="closeProfileMenuOnBackdrop(event)">
  <div class="bg-black/90 border border-[#A7C69F]/30 rounded-lg shadow-lg min-w-[220px] w-[250px] max-w-xs backdrop-blur-sm" onclick="event.stopPropagation()">
    <div class="p-4 space-y-3">
      <div class="text-white text-sm px-4 py-2 border-b border-[#A7C69F]/20">
        <p class="font-semibold"><span id="profileUsername">User</span></p>
        <p class="text-xs text-gray-400"><span id="profileEmail">email@example.com</span></p>
      </div>
      <button type="button" id="infoDropdownButton" class="w-full text-left px-4 py-2 text-white flex items-center gap-2 hover:bg-[#A7C69F]/10 transition-colors rounded justify-between">
        <span class="flex items-center gap-2"><span class="material-symbols-outlined" style="font-size: 20px; display: inline-flex;">info</span>Info</span>
        <span class="material-symbols-outlined transition-transform" id="infoDropdownArrow" style="font-size:19px;">expand_more</span>
      </button>
      <div id="infoDropdownMenu" class="hidden flex flex-col gap-1 mb-1 px-2 pt-1 ">
          <a href="overview.html" class="w-full text-left px-4 py-2 text-white hover:bg-[#A7C69F]/10 transition-colors rounded flex items-center gap-2"><span class="material-symbols-outlined" style="font-size:18px;">subject</span>Overview</a>
          <a href="features.html" class="w-full text-left px-4 py-2 text-white hover:bg-[#A7C69F]/10 transition-colors rounded flex items-center gap-2"><span class="material-symbols-outlined" style="font-size:18px;">star</span>Features</a>
          <a href="resources.html" class="w-full text-left px-4 py-2 text-white hover:bg-[#A7C69F]/10 transition-colors rounded flex items-center gap-2"><span class="material-symbols-outlined" style="font-size:18px;">book</span>Resources</a>
      </div>
      <button onclick="handleLogout()" class="w-full text-left px-4 py-2 text-white hover:bg-[#A7C69F]/10 transition-colors rounded flex items-center gap-2"><span class="material-symbols-outlined" style="font-size: 20px; display: inline-flex;">logout</span> Logout</button>
      <button onclick="handleDeleteAccount()" class="w-full text-left px-4 py-2 text-red-500 hover:bg-red-500/10 transition-colors rounded flex items-center gap-2"><span class="material-symbols-outlined" style="font-size: 20px; display: inline-flex;">delete</span> Delete Account</button>
    </div>
  </div>
</div>

<div class="py-16 sm:py-24">
<div class="max-w-6xl mx-auto">
<div class="bg-black/20 border border-white/20 rounded-lg backdrop-blur-sm p-8">
<div class="flex justify-between items-center mb-8">
  <h1 class="text-3xl font-bold text-white glow-text">My Financial Plans</h1>
  <a href="createplan.html" class="px-6 py-3 rounded-lg bg-[#A7C69F] text-[#333333] font-bold hover:bg-[#89b788] transition-colors glow-button flex items-center gap-2">
    <span class="material-symbols-outlined" style="font-size: 20px;">add</span>
    Create New Plan
  </a>
</div>

<div id="plans_container" class="space-y-4">
  <!-- Plans will be loaded here -->
</div>

<div id="empty_state" class="text-center py-16 hidden">
  <span class="material-symbols-outlined text-6xl text-white/40 mb-4" style="font-size: 64px;">account_balance_wallet</span>
  <h2 class="text-2xl font-bold text-white/60 mb-2">No Plans Yet</h2>
  <p class="text-white/40 mb-6">Create your first financial plan to get started</p>
  <a href="createplan.html" class="inline-block px-6 py-3 rounded-lg bg-[#A7C69F] text-[#333333] font-bold hover:bg-[#89b788] transition-colors glow-button">
    Create Your First Plan
  </a>
</div>
</div>
</div>
</div>

<footer class="flex flex-col items-center justify-between gap-6 border-t border-white/20 py-8 px-4 mt-8 text-center md:flex-row md:text-left">
<div class="flex items-center gap-3">
<div class="size-4">
<svg class="text-[#A7C69F]" fill="none" viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg">
<path clip-rule="evenodd" d="M24 4H6V17.3333V30.6667H24V44H42V30.6667V17.3333H24V4Z" fill="currentColor" fill-rule="evenodd"></path>
</svg>
</div>
<p class="text-sm text-white/60">Â© 2024 AIWallet. All rights reserved.</p>
</div>
<div class="flex items-center gap-6">
<a class="text-sm text-white/60 hover:text-white transition-colors" href="#">Privacy Policy</a>
<a class="text-sm text-white/60 hover:text-white transition-colors" href="#">Terms of Service</a>
<a class="text-sm text-white/60 hover:text-white transition-colors" href="#">Contact</a>
</div>
</footer>
</div>
</div>
</div>
</div>

<script>
// Load profile data on page load
window.addEventListener('load', function() {
  checkUserStatus();
  loadPlans();
});

function loadPlans() {
  const userId = localStorage.getItem('userId');
  if (!userId) {
    if (window.showCustomModal) {
      window.showCustomModal({
        type: 'confirm',
        title: 'Not Logged In',
        message: 'Please log in to view your plans.',
        confirmText: 'OK',
        cancelText: '',
        onConfirm: function() {
          window.location.href = 'signin.html';
        }
      });
    }
    return;
  }

  const allPlans = JSON.parse(localStorage.getItem('financial_plans_db') || '{}');
  const userPlans = allPlans[userId] || [];
  
  const plansContainer = document.getElementById('plans_container');
  const emptyState = document.getElementById('empty_state');

  if (userPlans.length === 0) {
    plansContainer.innerHTML = '';
    emptyState.classList.remove('hidden');
    return;
  }

  emptyState.classList.add('hidden');
  
  // Sort plans: pinned first, then by creation date (newest first)
  const sortedPlans = [...userPlans].sort((a, b) => {
    if (a.pinned && !b.pinned) return -1;
    if (!a.pinned && b.pinned) return 1;
    return new Date(b.createdAt) - new Date(a.createdAt);
  });

  plansContainer.innerHTML = sortedPlans.map(plan => {
    const date = new Date(plan.createdAt);
    const formattedDate = date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
    
    const expensesList = plan.expenses.map(exp => 
      `<div class="flex justify-between text-sm py-1">
        <span class="text-white/70">${exp.name}</span>
        <span class="text-white">$${exp.amount.toLocaleString()}</span>
      </div>`
    ).join('');

    return `
      <div class="plan-card bg-black/30 border border-white/10 rounded-lg p-6 ${plan.pinned ? 'pinned' : ''}" data-plan-id="${plan.id}">
        <div class="flex justify-between items-start mb-4">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-2">
              ${plan.pinned ? '<span class="material-symbols-outlined text-[#A7C69F]" style="font-size: 20px;">push_pin</span>' : ''}
              <h3 class="text-xl font-bold text-white">Plan from ${formattedDate}</h3>
            </div>
            <p class="text-white/60 text-sm">Created on ${formattedDate}</p>
          </div>
          <div class="flex gap-2">
            <button onclick="togglePin('${plan.id}')" class="p-2 rounded-lg hover:bg-[#A7C69F]/10 transition-colors" title="${plan.pinned ? 'Unpin' : 'Pin'}">
              <span class="material-symbols-outlined ${plan.pinned ? 'text-[#A7C69F]' : 'text-white/60'}" style="font-size: 20px; font-variation-settings: 'FILL' ${plan.pinned ? 1 : 0};">
                push_pin
              </span>
            </button>
            <button onclick="deletePlan('${plan.id}')" class="p-2 rounded-lg hover:bg-red-500/10 transition-colors text-red-400" title="Delete">
              <span class="material-symbols-outlined" style="font-size: 20px;">delete</span>
            </button>
          </div>
        </div>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
          <div class="bg-black/20 rounded-lg p-4">
            <p class="text-white/60 text-sm mb-1">Salary</p>
            <p class="text-2xl font-bold text-[#A7C69F] glow-text">$${plan.salary.toLocaleString()}</p>
          </div>
          <div class="bg-black/20 rounded-lg p-4">
            <p class="text-white/60 text-sm mb-1">Debts</p>
            <p class="text-2xl font-bold text-red-400">$${plan.debts.toLocaleString()}</p>
          </div>
          <div class="bg-black/20 rounded-lg p-4">
            <p class="text-white/60 text-sm mb-1">Total Expenses</p>
            <p class="text-2xl font-bold text-white">$${plan.totalExpenses.toLocaleString()}</p>
          </div>
          <div class="bg-black/20 rounded-lg p-4">
            <p class="text-white/60 text-sm mb-1">Daily Limit</p>
            <p class="text-2xl font-bold text-[#A7C69F] glow-text">$${plan.dailyLimit.toLocaleString()}</p>
          </div>
        </div>

        <div class="bg-black/20 rounded-lg p-4 mb-4">
          <p class="text-white/60 text-sm mb-2">Remaining for Month</p>
          <p class="text-3xl font-bold text-[#A7C69F] glow-text">$${plan.moneyLeft.toLocaleString()}</p>
        </div>

        ${plan.expenses.length > 0 ? `
          <div class="bg-black/20 rounded-lg p-4">
            <p class="text-white/60 text-sm mb-3 font-semibold">Expenses Breakdown</p>
            ${expensesList}
          </div>
        ` : ''}
      </div>
    `;
  }).join('');
}

function togglePin(planId) {
  const userId = localStorage.getItem('userId');
  if (!userId) return;

  const allPlans = JSON.parse(localStorage.getItem('financial_plans_db') || '{}');
  const userPlans = allPlans[userId] || [];
  
  const planIndex = userPlans.findIndex(p => p.id === planId);
  if (planIndex === -1) return;

  userPlans[planIndex].pinned = !userPlans[planIndex].pinned;
  allPlans[userId] = userPlans;
  localStorage.setItem('financial_plans_db', JSON.stringify(allPlans));

  loadPlans();
}

function deletePlan(planId) {
  if (window.showCustomModal) {
    window.showCustomModal({
      type: 'confirm',
      title: 'Delete Plan',
      message: 'Are you sure you want to delete this plan? This action cannot be undone.',
      confirmText: 'Delete',
      cancelText: 'Cancel',
      onConfirm: function() {
        const userId = localStorage.getItem('userId');
        if (!userId) return;

        const allPlans = JSON.parse(localStorage.getItem('financial_plans_db') || '{}');
        const userPlans = allPlans[userId] || [];
        
        allPlans[userId] = userPlans.filter(p => p.id !== planId);
        localStorage.setItem('financial_plans_db', JSON.stringify(allPlans));

        loadPlans();
      }
    });
  } else {
    if (confirm('Are you sure you want to delete this plan?')) {
      const userId = localStorage.getItem('userId');
      if (!userId) return;

      const allPlans = JSON.parse(localStorage.getItem('financial_plans_db') || '{}');
      const userPlans = allPlans[userId] || [];
      
      allPlans[userId] = userPlans.filter(p => p.id !== planId);
      localStorage.setItem('financial_plans_db', JSON.stringify(allPlans));

      loadPlans();
    }
  }
}

// Make functions globally accessible
window.togglePin = togglePin;
window.deletePlan = deletePlan;
</script>
</body>
</html>

